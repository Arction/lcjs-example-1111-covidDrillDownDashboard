(self.webpackChunk=self.webpackChunk||[]).push([[524],{44:(e,t,o)=>{const s=o(377),{AxisScrollStrategies:n,AxisTickStrategies:i,emptyTick:a,AutoCursorModes:r,FormattingFunctions:l,LUT:c,lightningChart:d,UIElementBuilders:u,UILayoutBuilders:p,PointShape:g,ColorCSS:m,ColorRGBA:y,emptyFill:h,PalettedFill:x,SolidFill:S,emptyLine:f,synchronizeAxisIntervals:v,transparentFill:b,UIOrigins:w,MouseStyles:k,SolidLine:T,UIDraggingModes:_,Themes:M,regularColorSteps:I}=s,C=d({resourcesBaseUrl:new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"resources/"}).Dashboard({numberOfColumns:1,numberOfRows:4,theme:M[new URLSearchParams(window.location.search).get("theme")||"darkGold"]||void 0}),F=C.getTheme();let R=!0;const A=new c({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...I(0,1e3,F.examples.badGoodColorPalette.reverse())]}),D=new c({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...I(0,100,F.examples.badGoodColorPalette.reverse())]}),L={World:[{mapType:"NorthAmerica",boundary:{bottomLeft:{x:.04,y:.52},topRight:{x:.44,y:.93}}},{mapType:"SouthAmerica",boundary:{bottomLeft:{x:.16,y:.14},topRight:{x:.45,y:.5}}},{mapType:"Europe",boundary:{bottomLeft:{x:.45,y:.64},topRight:{x:.6,y:.93}}},{mapType:"Africa",boundary:{bottomLeft:{x:.46,y:.15},topRight:{x:.63,y:.64}}},{mapType:"Asia",boundary:{bottomLeft:{x:.59,y:.4},topRight:{x:.95,y:.91}}}]},P=C.addUIElement(p.Column,C.coordsRelative).setOrigin(w.RightTop).setBackground((e=>e.setFillStyle(h).setStrokeStyle(f))),B=P.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Left click to drill down at mouse location"),U=P.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Double left click to zoom out"),E=C.addUIElement(u.TextBox,C.coordsRelative).setOrigin(w.LeftTop).setText("Zoom out").setTextFont((e=>e.setSize(20))).setDraggingMode(_.notDraggable).setMouseStyle(k.Point);C.onResize((()=>{const e=C.engine.container.getBoundingClientRect();P.setPosition({x:e.width-8,y:e.height-40}),E.setPosition({x:8,y:e.height-8})})),(async()=>{let e,t,o,s;await Promise.all([new Promise((async t=>{console.time("loading covid data"),e=await fetch(new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"examples/assets/1111/owid-covid-data.json").then((e=>e.json())),console.timeEnd("loading covid data"),t()})),new Promise((async e=>{console.time("loading covid vaccinations data"),t=await fetch(new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"examples/assets/1111/vaccinations.json").then((e=>e.json())),console.timeEnd("loading covid vaccinations data"),e()})),new Promise((async e=>{console.time("loading country locations data"),o=await fetch(new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"examples/assets/1111/countries.json").then((e=>e.json())),console.timeEnd("loading country locations data"),e()}))]);const r=new Date(2020,10,1).getTime();let c=new Date(2022,2,11),g=z(e.FIN.data[e.FIN.data.length-1].date),y=0;const M=async a=>{y=window.performance.now(),s=s||(()=>{console.time("calculate new cases history");const o=new Map,n=new Map;for(const s of Object.keys(e)){const i=e[s];for(let e=0;e<i.data.length;e+=1){const t=i.data[e],s=t.new_cases;if(void 0!==s){const e=o.get(t.date);e?o.set(t.date,e+s):o.set(t.date,s)}}const a=t.find((e=>e.iso_code===s));for(let e=0;e<a.data.length;e+=1){const t=a.data[e],o=t.people_vaccinated_per_hundred;if(void 0!==o){const e=n.get(t.date);e?(e.count+=1,e.sum+=o):n.set(t.date,{count:1,sum:o})}}}const a=Array.from(o.entries()).map((([e,t])=>({x:z(e),y:t}))).filter((e=>e.x>=r)).sort(((e,t)=>e.x-t.x)),c=Array.from(n.entries()).map((([e,t])=>({x:z(e),y:t.sum/t.count}))).filter((e=>e.x>=r)).sort(((e,t)=>e.x-t.x));o.clear(),n.clear();const d=C.createChartXY({columnIndex:0,rowIndex:1}).setTitle("Global CoVID daily new cases history").setCursorMode(void 0).setMouseInteractions(!1),p=d.addAxisX({opposite:!0}).setTickStrategy(i.Empty).setStrokeStyle(f).setMouseInteractions(!1),m=p.addCustomTick(u.PointableTextBox).setMouseInteractions(!0).setAllocatesAxisSpace(!1).setTextFormatter((e=>new Date(e).toLocaleDateString("fin",{})));v(d.getDefaultAxisX(),p),d.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).add(a),d.getDefaultAxisY().setMouseInteractions(!1).setTitle("New daily cases").setTitleFont((e=>e.setSize(12))).setTickStrategy(i.Numeric,(e=>e.setFormattingFunction(l.NumericUnits))).fit(!1);const y=d.addAxisY({opposite:!0}).setTitle("Vaccinated once (%)").setTitleFont((e=>e.setSize(12))).setMouseInteractions(!1).setInterval({start:0,end:100});return d.addLineSeries({dataPattern:{pattern:"ProgressiveX"},yAxis:y}).add(c).setStrokeStyle(new T({thickness:2,fillStyle:new x({lookUpProperty:"y",lut:D})})),d.getDefaultAxisX().setTickStrategy(i.DateTime).setMouseInteractions(!1).fit(!1),m.onMouseDrag(((e,t)=>{const o=d.translateCoordinate(t,d.coordsAxis),n=Math.min(Math.max(o.x,r),g);m.setValue(n),s.onChange&&s.onChange(n)})),m.onMouseEnter(((e,t)=>{d.engine.setMouseStyle(k.Horizontal)})),m.onMouseLeave(((e,t)=>{d.engine.setMouseStyle(k.Default)})),console.timeEnd("calculate new cases history"),s={chart:d,highlighter:m,onChange:()=>{},deactivate:()=>{d.dispose(),s=void 0}},s})(),B.setVisible(!0),"World"!==a?(U.setVisible(!0),E.setVisible(!0)):(U.setVisible(!1),E.setVisible(!1)),C.setRowHeight(0,4).setRowHeight(1,1);for(let e=2;e<4;e+=1)C.setRowHeight(e,0);const _=C.createMapChart({columnIndex:0,rowIndex:0,type:a}).setCursorMode(void 0).setMouseInteractions(!1).setPadding({top:40}),P=C.createChartXY({columnIndex:0,rowIndex:0}).setTitle("").setBackgroundFillStyle(b).setSeriesBackgroundFillStyle(b).setSeriesBackgroundStrokeStyle(f).setCursorMode(void 0).setMouseInteractions(!1);P.forEachAxis((e=>e.setTickStrategy(i.Empty).setStrokeStyle(f))),_.onViewChange((e=>{P.setPadding({left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom}),P.getDefaultAxisX().setInterval({start:e.longitudeRange.start,end:e.longitudeRange.end}),P.getDefaultAxisY().setInterval({start:e.latitudeRange.start,end:e.latitudeRange.end})})),_.setFillStyle(new x({lut:D}));const Y=P.addPointLineAreaSeries({dataPattern:null,sizes:!0,lookupValues:!0,ids:!0}).setStrokeStyle(f).setPointFillStyle(new x({lut:A})).setMouseInteractions(!1);let O=[];const j=(n,i=!1)=>{c=n;const r=n.getTime(),l=V(n);_.setTitle(`CoVID vaccinations & new cases | ${n.toLocaleDateString("fin",{})}`),Y.clear();let d=0;O=[],_.invalidateRegionValues(((s,n)=>{const i=s.ISO_A3,c=e[i],u=t.find((e=>e.iso_code===i)),p=o.find((e=>e.cca3===i));if(c&&u&&p){const e=c.data.find((e=>e.date===l)),t=e&&e.new_cases_smoothed_per_million;let o;for(let e=u.data.length-1;e>=0;e-=1){const t=u.data[e];if(void 0!==t.people_vaccinated_per_hundred&&z(t.date)<=r){o=t.people_vaccinated_per_hundred;break}}if(void 0!==t&&void 0!==o){const e=p.latlng[0],n=p.latlng[1],i=0===t?0:$(25*t/1e3,"World"===a?1:5,25);return Y.add({id:d,x:n,y:e,lookupValue:t,size:i}),O.push(s),d+=1,o}}return-1})),i&&s&&s.highlighter.setValue(n.getTime())};let H;j(c,!0),s.onChange=e=>{H=new Date(e)};const W=setInterval((()=>{H&&(j(H),H=void 0)}),1e3/60),G=document.getElementById("chart-container")||document.body,Z=document.createElement("div");G.append(Z);const q=d().ChartXY({container:Z,theme:F}).setTitle("").setPadding({left:0,bottom:0,right:0,top:14}).setMouseInteractions(!1).setBackgroundFillStyle(F.cursorResultTableFillStyle);q.setBackgroundFillStyle(h).setBackgroundStrokeStyle(f).setSeriesBackgroundFillStyle(h).setSeriesBackgroundStrokeStyle(f),q.engine.setBackgroundFillStyle(h),q.getDefaultAxisY().dispose(),q.getDefaultAxisX().setAnimationScroll(!1);const J=q.addUIElement(p.Column).setPosition({x:0,y:100}).setOrigin(w.LeftTop).setBackground((e=>e.setStrokeStyle(f).setFillStyle(h))),K=e=>J.addElement(u.TextBox).setText(e),Q=K("");F.isDark||Q.setTextFillStyle(new S({color:m("rgb(255,255,255)")}));const ee=(e,t,o,s,i)=>{const a=new S({color:m(e)}),r=q.addAxisY().setInterval({start:0,end:o,stopAxisAfter:!1}).setScrollStrategy(n.expansion);return{series:q.addLineSeries({yAxis:r,dataPattern:{pattern:"ProgressiveX"}}).setStrokeStyle((e=>e.setFillStyle(a))),label:K(t).setTextFillStyle(a),valueLabel:q.addUIElement(u.TextBox,{x:q.getDefaultAxisX(),y:r}).setOrigin(w.RightBottom).setTextFillStyle(a).setText("").setBackground((e=>e.setStrokeStyle(f).setFillStyle(h))),format:s,dataSet:i}},te={people_vaccinated_per_hundred:ee("rgb(0, 255, 0)","Vaccinations",100,(e=>void 0!==e.people_vaccinated_per_hundred?`${e.people_vaccinated_per_hundred.toFixed(1)}%`:void 0),t),new_cases_per_million:ee("rgb(255, 255, 0)","New cases",1e3,(e=>void 0!==e.new_cases?String(e.new_cases):void 0),e),hosp_patients_per_million:ee("rgb(255, 127, 0)","Hospitalized",100,(e=>void 0!==e.hosp_patients?String(e.hosp_patients):void 0),e),icu_patients_per_million:ee("rgb(255, 0, 0)","Severe cases",50,(e=>void 0!==e.icu_patients?String(e.icu_patients):void 0),e)};let oe,se,ne;Z.style.position="absolute",Z.style.top="0px",Z.style.backgroundColor="rgba(0,0,0,0.7)",Z.style.border="solid 8px transparent",Z.style.borderRadius="16px",Z.style.width="280px",Z.style.height="200px",Z.style.transition="left 0.2s, top 0.2s, opacity 0.5s",Z.style.opacity="0.0",Z.style.pointerEvents="none",q.forEachAxis((e=>e.setTickStrategy(i.Empty).setStrokeStyle(f).setMouseInteractions(!1))),_.onMapDataReady((()=>{setTimeout((()=>{oe={countryCode:"ITA",x:12.83,y:42.83}}),500)})),P.onSeriesBackgroundMouseMove(((e,t)=>{const o=Y.solveNearest(t),s=O[o?.id];o&&s&&(oe={countryCode:s.ISO_A3,...o},ne=oe.countryCode)})),P.onSeriesBackgroundMouseLeave((()=>{se=void 0,oe=void 0}));const ie=setInterval((()=>{if(oe&&oe.countryCode!==se){const s=P.translateCoordinate(oe,P.coordsAxis,P.coordsClient),n=G.getBoundingClientRect();Z.style.left=`${Math.max(s.clientX-(290+n.left),10)}px`,Z.style.top=`${Math.max(s.clientY-(210+n.top),10)}px`,Z.style.opacity="1.0",q.engine.layout();const i=30,a=e[oe.countryCode],r=t.find((e=>e.iso_code===oe.countryCode)),l=o.find((e=>e.cca3===oe.countryCode));Q.setText(`${l.name.common} previous 4 weeks`);const d=N(new Date(c.getTime()-24*i*60*60*1e3),c),u=a.data.filter((e=>d(e.date))),p=r.data.filter((e=>d(e.date)));for(const t of Object.keys(te)){const{series:o,valueLabel:s,dataSet:n,format:i}=te[t],a=n===e?u:p,r=a.map((e=>({x:z(e.date),y:void 0!==e[t]?e[t]:NaN}))).filter((e=>!Number.isNaN(e.y)));let l;o.clear().add(r);for(let e=r.length-1;e>=0&&(l=r[e],Number.isNaN(l.y));e-=1);if(s.setText(""),void 0!==l){let e;for(let t=a.length-1;t>=0&&(e=i(a[t]),!e);t-=1);if(e){const t={x:l.x,y:l.y};s.setText(e).setPosition(t)}}}se=oe.countryCode}oe=void 0,se||(Z.style.opacity="0.0")}),1e3/60);X(P.onSeriesBackgroundMouseClick.bind(P),P.onSeriesBackgroundMouseDoubleClick.bind(P),(e=>{if(window.performance.now()-y<750)return;const t=P.translateCoordinate(e,P.coordsRelative),o=P.getSizePixels(),s=t.x/o.x,n=t.y/o.y,i=L[a]||[];for(const e of i)if(s>=e.boundary.bottomLeft.x&&s<=e.boundary.topRight.x&&n>=e.boundary.bottomLeft.y&&n<=e.boundary.topRight.y)return re(),void M(e.mapType);ne&&(re(),I(ne,a,R))}),(e=>{window.performance.now()-y>2e3&&"World"!==a&&(re(),M("World"))}));const ae=E.onMouseClick(((e,t)=>{"World"!==a&&window.performance.now()-y>500&&(re(),M("World"))}));let re=()=>{clearInterval(ie),clearInterval(W),_.dispose(),P.dispose(),q.dispose(),Z.remove(),E.offMouseClick(ae),re=()=>{}}},I=(l,c,d)=>{s&&s.deactivate(),B.setVisible(!1),U.setVisible(!0),E.setVisible(!0);const p=e[l],g=t.find((e=>e.iso_code===l)),m=o.find((e=>e.cca3===l)),x=(e,t,o,s,n,i)=>({property:e,dataSet:t,title:o,titleY:s,maxY:n,format:i}),S=[x("people_vaccinated_per_hundred",g,"Vaccination rate (at least 1 vaccine)","Vaccinated (%)",100,(e=>`${e.toFixed(1)}% received at least 1 vaccine`)),x(d?"new_cases_per_million":"new_cases",p,d?"New cases (relative to population)":"New cases",d?"per 1 million citizens":"New cases",d?1e3:void 0,d?e=>`${e.toFixed(0)} new cases per 1 million citizens`:e=>`${e.toFixed(0)} new cases`),x(d?"hosp_patients_per_million":"hosp_patients",p,d?"Hospital patients (relative to population)":"Hospital patients",d?"per 1 million citizens":"Hospital patients",d?100:void 0,d?e=>`${e.toFixed(0)} hospital patients per 1 million citizens`:e=>`${e.toFixed(0)} hospital patients`),x(d?"icu_patients_per_million":"icu_patients",p,d?"Intensive hospital care patients (relative to population)":"Intensive hospital care patients",d?"per 1 million citizens":"Intensive care patients",d?50:void 0,d?e=>`${e.toFixed(0)} intensive care patients per 1 million citizens`:e=>`${e.toFixed(0)} intensive care patients`)].map(((e,t,o)=>{const s=C.createChartXY({columnIndex:0,rowIndex:t}).setTitle(e.title).setPadding({left:0});if(0===t){const e=s.addUIElement(u.TextBox,s.coordsRelative).setText(`${m.name.common}`).setTextFont((e=>e.setSize(22))).setBackground((e=>e.setFillStyle(h).setStrokeStyle(f)));s.onResize((()=>{e.setPosition({x:140,y:s.getSizePixels().y}).setOrigin(w.LeftTop)}));const t=s.addUIElement(u.TextBox).setPosition({x:100,y:100}).setOrigin(w.RightTop).setMargin({top:14,right:24}).setDraggingMode(_.notDraggable);t.onMouseEnter((e=>s.engine.setMouseStyle(k.Point))),t.onMouseLeave((e=>s.engine.setMouseStyle(k.Default)));const o=e=>{e!==R&&(R=e,A(),I(l,c,e)),t.setText(e?"Show actual values":"Show relative values")};t.onMouseClick((e=>o(!R))),o(R)}const d=s.getDefaultAxisX().setAnimationScroll(!1);t<o.length-1?d.setMouseInteractions(!1).setThickness(0).setStrokeStyle(f).setTickStrategy(i.DateTime,(e=>e.setGreatTickStyle(a).setMajorTickStyle((e=>e.setLabelFillStyle(b).setTickStyle(f))).setMinorTickStyle((e=>e.setLabelFillStyle(b).setTickStyle(f))))):d.setTickStrategy(i.DateTime);const p=s.getDefaultAxisY().setTitle(e.titleY||"").setTitleFont((e=>e.setSize(12))).setThickness({min:80});void 0!==e.maxY&&p.setInterval({start:0,end:e.maxY,stopAxisAfter:!1}).setScrollStrategy(n.expansion);const g=s.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName(`${m.name.common}`),y=e.dataSet.data.map((t=>({x:z(t.date),y:t[e.property]}))).filter((e=>void 0!==e.y&&e.x>=r));g.add(y);const x=P&&P[e.property];let S;if(x){S=s.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName("Global average").add(x);const e=g.getStrokeStyle();S.setStrokeStyle(e.setFillStyle(e.getFillStyle().setA(100)))}return{...e,chart:s,series:g,seriesAverage:S}}));v(...S.map((e=>e.chart.getDefaultAxisX())));for(let e=0;e<4;e+=1)C.setRowHeight(e,e<S.length?1:0);const T=()=>{A&&A(),M(c)};S.forEach((e=>{X(e.chart.onSeriesBackgroundMouseClick.bind(e.chart),e.chart.onSeriesBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),T),X(e.chart.onBackgroundMouseClick.bind(e.chart),e.chart.onBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),T)}));const F=E.onMouseClick((()=>T()));let A=()=>{S.forEach((e=>{e.chart.dispose()})),E.offMouseClick(F),A=void 0};y=window.performance.now()};let P;console.time("calculate global averages"),P={new_cases_per_million:[],hosp_patients_per_million:[],icu_patients_per_million:[]};for(const t of Object.keys(P)){const o=new Map;for(const s of Object.keys(e)){const n=e[s];if(n)for(let e=0;e<n.data.length;e+=1){const s=n.data[e],i=s[t];if(void 0!==i){const e=o.get(s.date);e?(e.count+=1,e.sum+=i):o.set(s.date,{count:1,sum:i})}}}const s=Array.from(o.entries()).map((([e,t])=>({x:z(e),y:t.sum/t.count}))).sort(((e,t)=>e.x-t.x)).filter((e=>e.x>=r));P[t]=s}console.timeEnd("calculate global averages"),M("World")})();const N=(e,t)=>{const o=e.getFullYear(),s=e.getMonth(),n=e.getDate(),i=t.getFullYear(),a=t.getMonth(),r=t.getDate(),l=372*o+31*s+n,c=372*i+31*a+r;return e=>{const t=372*Number(e.substring(0,4))+31*(Number(e.substring(5,7))-1)+Number(e.substring(8,10));return t>=l&&t<=c}},z=e=>{const t=Number(e.substring(0,4)),o=Number(e.substring(5,7))-1,s=Number(e.substring(8,10));return new Date(t,o,s).getTime()},V=e=>`${e.getFullYear()}-${Y(e.getMonth()+1,2)}-${Y(e.getDate(),2)}`,Y=(e,t)=>{let o=String(e);for(;o.length<t;)o=`0${o}`;return o},X=(e,t,o,s)=>{let n=0;e(((e,t)=>{setTimeout((()=>{window.performance.now()-n>=500&&o(t)}),200)})),t(((e,t)=>{n=window.performance.now(),s(t)}))},$=(e,t,o)=>Math.min(Math.max(e,t),o)}},e=>{e.O(0,[502],(()=>e(e.s=44))),e.O()}]);