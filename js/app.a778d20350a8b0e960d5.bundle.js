(self.webpackChunk=self.webpackChunk||[]).push([[524],{44:(e,t,o)=>{const s=o(89),{AxisScrollStrategies:n,AxisTickStrategies:a,emptyTick:i,AutoCursorModes:r,FormattingFunctions:l,LUT:c,lightningChart:d,UIElementBuilders:u,UILayoutBuilders:p,PointShape:g,ColorCSS:m,ColorRGBA:y,emptyFill:x,PalettedFill:h,SolidFill:S,emptyLine:f,synchronizeAxisIntervals:v,translatePoint:b,transparentFill:w,UIOrigins:T,MouseStyles:k,SolidLine:_,UIDraggingModes:C,Themes:M,regularColorSteps:I}=s,F=d().Dashboard({numberOfColumns:1,numberOfRows:4,theme:M[new URLSearchParams(window.location.search).get("theme")||"darkGold"]||void 0}),A=F.getTheme();let R=!0;const D=new c({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...I(0,1e3,A.examples.badGoodColorPalette.reverse())]}),P=new c({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...I(0,100,A.examples.badGoodColorPalette.reverse())]}),B={World:[{mapType:"NorthAmerica",boundary:{bottomLeft:{x:.04,y:.52},topRight:{x:.44,y:.93}}},{mapType:"SouthAmerica",boundary:{bottomLeft:{x:.16,y:.14},topRight:{x:.45,y:.5}}},{mapType:"Europe",boundary:{bottomLeft:{x:.45,y:.64},topRight:{x:.6,y:.93}}},{mapType:"Africa",boundary:{bottomLeft:{x:.46,y:.15},topRight:{x:.63,y:.64}}},{mapType:"Asia",boundary:{bottomLeft:{x:.59,y:.4},topRight:{x:.95,y:.91}}}]},E=F.addUIElement(p.Column,F.coordsRelative).setOrigin(T.RightTop).setBackground((e=>e.setFillStyle(x).setStrokeStyle(f))),L=E.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Left click to drill down at mouse location"),N=E.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Double left click to zoom out"),z=F.addUIElement(u.TextBox,F.coordsRelative).setOrigin(T.LeftTop).setText("Zoom out").setTextFont((e=>e.setSize(20))).setDraggingMode(C.notDraggable).setMouseStyle(k.Point);F.onResize((()=>{const e=F.engine.container.getBoundingClientRect();E.setPosition({x:e.width-8,y:e.height-40}),z.setPosition({x:8,y:e.height-8})})),(async()=>{let e,t,o,s;await Promise.all([new Promise((async t=>{console.time("loading covid data"),e=await fetch(document.head.baseURI+"examples/assets/1111/owid-covid-data.json").then((e=>e.json())),console.timeEnd("loading covid data"),t()})),new Promise((async e=>{console.time("loading covid vaccinations data"),t=await fetch(document.head.baseURI+"examples/assets/1111/vaccinations.json").then((e=>e.json())),console.timeEnd("loading covid vaccinations data"),e()})),new Promise((async e=>{console.time("loading country locations data"),o=await fetch(document.head.baseURI+"examples/assets/1111/countries.json").then((e=>e.json())),console.timeEnd("loading country locations data"),e()}))]);const c=new Date(2020,10,1).getTime();let y=new Date(2022,2,11),b=Y(e.FIN.data[e.FIN.data.length-1].date),M=0;const I=async i=>{M=window.performance.now(),s=s||(()=>{console.time("calculate new cases history");const o=new Map,n=new Map;for(const s of Object.keys(e)){const a=e[s];for(let e=0;e<a.data.length;e+=1){const t=a.data[e],s=t.new_cases;if(void 0!==s){const e=o.get(t.date);e?o.set(t.date,e+s):o.set(t.date,s)}}const i=t.find((e=>e.iso_code===s));for(let e=0;e<i.data.length;e+=1){const t=i.data[e],o=t.people_vaccinated_per_hundred;if(void 0!==o){const e=n.get(t.date);e?(e.count+=1,e.sum+=o):n.set(t.date,{count:1,sum:o})}}}const i=Array.from(o.entries()).map((([e,t])=>({x:Y(e),y:t}))).filter((e=>e.x>=c)).sort(((e,t)=>e.x-t.x)),d=Array.from(n.entries()).map((([e,t])=>({x:Y(e),y:t.sum/t.count}))).filter((e=>e.x>=c)).sort(((e,t)=>e.x-t.x));o.clear(),n.clear();const p=F.createChartXY({columnIndex:0,rowIndex:1}).setTitle("Global CoVID daily new cases history").setAutoCursorMode(r.disabled).setMouseInteractions(!1),g=p.addAxisX({opposite:!0}).setTickStrategy(a.Empty).setStrokeStyle(f).setMouseInteractions(!1),m=g.addCustomTick(u.PointableTextBox).setMouseInteractions(!0).setAllocatesAxisSpace(!1).setTextFormatter((e=>new Date(e).toLocaleDateString("fin",{})));v(p.getDefaultAxisX(),g),p.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setCursorInterpolationEnabled(!1).add(i),p.getDefaultAxisY().setMouseInteractions(!1).setTitle("New daily cases").setTitleFont((e=>e.setSize(12))).setTickStrategy(a.Numeric,(e=>e.setFormattingFunction(l.NumericUnits))).fit(!1);const y=p.addAxisY({opposite:!0}).setTitle("Vaccinated once (%)").setTitleFont((e=>e.setSize(12))).setMouseInteractions(!1).setInterval({start:0,end:100});return p.addLineSeries({dataPattern:{pattern:"ProgressiveX"},yAxis:y}).setCursorInterpolationEnabled(!1).add(d).setStrokeStyle(new _({thickness:2,fillStyle:new h({lookUpProperty:"y",lut:P})})),p.getDefaultAxisX().setTickStrategy(a.DateTime).setMouseInteractions(!1).fit(!1),m.onMouseDrag(((e,t)=>{const o=p.translateCoordinate(t,p.coordsAxis),n=Math.min(Math.max(o.x,c),b);m.setValue(n),s.onChange&&s.onChange(n)})),m.onMouseEnter(((e,t)=>{p.engine.setMouseStyle(k.Horizontal)})),m.onMouseLeave(((e,t)=>{p.engine.setMouseStyle(k.Default)})),console.timeEnd("calculate new cases history"),s={chart:p,highlighter:m,onChange:()=>{},deactivate:()=>{p.dispose(),s=void 0}},s})(),L.setVisible(!0),"World"!==i?(N.setVisible(!0),z.setVisible(!0)):(N.setVisible(!1),z.setVisible(!1)),F.setRowHeight(0,4).setRowHeight(1,1);for(let e=2;e<4;e+=1)F.setRowHeight(e,0);const C=F.createMapChart({columnIndex:0,rowIndex:0,type:i}).setAutoCursorMode(r.disabled).setMouseInteractions(!1).setPadding({top:40}),X=F.createChartXY({columnIndex:0,rowIndex:0}).setTitle("").setBackgroundFillStyle(w).setSeriesBackgroundFillStyle(w).setSeriesBackgroundStrokeStyle(f).setAutoCursorMode(r.disabled).setMouseInteractions(!1);X.forEachAxis((e=>e.setTickStrategy(a.Empty).setStrokeStyle(f))),C.onViewChange((e=>{X.setPadding({left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom}),X.getDefaultAxisX().setInterval({start:e.longitudeRange.start,end:e.longitudeRange.end}),X.getDefaultAxisY().setInterval({start:e.latitudeRange.start,end:e.latitudeRange.end})})),C.setFillStyle(new h({lut:P}));const j=X.addPointSeries({pointShape:g.Circle}).setIndividualPointSizeEnabled(!0).setIndividualPointValueEnabled(!0).setPointFillStyle(new h({lut:D})).setMouseInteractions(!1),H=(n,a=!1)=>{y=n;const r=n.getTime(),l=$(n);C.setTitle(`CoVID vaccinations & new cases | ${n.toLocaleDateString("fin",{})}`),j.clear(),C.invalidateRegionValues(((s,n)=>{const a=s.ISO_A3,c=e[a],d=t.find((e=>e.iso_code===a)),u=o.find((e=>e.cca3===a));if(c&&d&&u){const e=c.data.find((e=>e.date===l)),t=e&&e.new_cases_smoothed_per_million;let o;for(let e=d.data.length-1;e>=0;e-=1){const t=d.data[e];if(void 0!==t.people_vaccinated_per_hundred&&Y(t.date)<=r){o=t.people_vaccinated_per_hundred;break}}if(void 0!==t&&void 0!==o){const e=u.latlng[0],s=u.latlng[1],n=0===t?0:O(25*t/1e3,"World"===i?1:5,25);return j.add({countryCode:a,smoothedNewCasesPerMillion:t,peopleVaccinatedPerHundred:o,x:s,y:e,value:t,size:n}),o}}return-1})),a&&s&&s.highlighter.setValue(n.getTime())};let G;H(y,!0),s.onChange=e=>{G=new Date(e)};const W=setInterval((()=>{G&&(H(G),G=void 0)}),1e3/60),Z=document.getElementById("chart-container")||document.body,q=document.createElement("div");Z.append(q);const J=d().ChartXY({container:q,theme:A}).setTitle("").setPadding({left:0,bottom:0,right:0,top:14}).setMouseInteractions(!1).setBackgroundFillStyle(A.cursorResultTableFillStyle);J.setBackgroundFillStyle(x).setBackgroundStrokeStyle(f).setSeriesBackgroundFillStyle(x).setSeriesBackgroundStrokeStyle(f),J.engine.setBackgroundFillStyle(x),J.getDefaultAxisY().dispose(),J.getDefaultAxisX().setAnimationScroll(!1);const K=J.addUIElement(p.Column).setPosition({x:0,y:100}).setOrigin(T.LeftTop).setBackground((e=>e.setStrokeStyle(f).setFillStyle(x))),Q=e=>K.addElement(u.TextBox).setText(e),ee=Q("");A.isDark||ee.setTextFillStyle(new S({color:m("rgb(255,255,255)")}));const te=(e,t,o,s,a)=>{const i=new S({color:m(e)}),r=J.addAxisY().setInterval({start:0,end:o,stopAxisAfter:!1}).setScrollStrategy(n.expansion);return{series:J.addLineSeries({yAxis:r,dataPattern:{pattern:"ProgressiveX"}}).setCursorInterpolationEnabled(!1).setStrokeStyle((e=>e.setFillStyle(i))),label:Q(t).setTextFillStyle(i),valueLabel:J.addUIElement(u.TextBox,{x:J.getDefaultAxisX(),y:r}).setOrigin(T.RightBottom).setTextFillStyle(i).setText("").setBackground((e=>e.setStrokeStyle(f).setFillStyle(x))),format:s,dataSet:a}},oe={people_vaccinated_per_hundred:te("rgb(0, 255, 0)","Vaccinations",100,(e=>void 0!==e.people_vaccinated_per_hundred?`${e.people_vaccinated_per_hundred.toFixed(1)}%`:void 0),t),new_cases_per_million:te("rgb(255, 255, 0)","New cases",1e3,(e=>void 0!==e.new_cases?String(e.new_cases):void 0),e),hosp_patients_per_million:te("rgb(255, 127, 0)","Hospitalized",100,(e=>void 0!==e.hosp_patients?String(e.hosp_patients):void 0),e),icu_patients_per_million:te("rgb(255, 0, 0)","Severe cases",50,(e=>void 0!==e.icu_patients?String(e.icu_patients):void 0),e)};let se,ne,ae;q.style.position="absolute",q.style.top="0px",q.style.backgroundColor="rgba(0,0,0,0.7)",q.style.border="solid 8px transparent",q.style.borderRadius="16px",q.style.width="280px",q.style.height="200px",q.style.transition="left 0.2s, top 0.2s, opacity 0.5s",q.style.opacity="0.0",q.style.pointerEvents="none",J.forEachAxis((e=>e.setTickStrategy(a.Empty).setStrokeStyle(f).setMouseInteractions(!1))),C.onMapDataReady((()=>{setTimeout((()=>{se={countryCode:"ITA",x:12.83,y:42.83}}),500)})),X.onSeriesBackgroundMouseMove(((e,t)=>{const o=j.solveNearestFromScreen(t);o&&(se=o.location,ae=se.countryCode)})),X.onSeriesBackgroundMouseLeave((()=>{ne=void 0,se=void 0}));const ie=setInterval((()=>{if(se&&se.countryCode!==ne){const s=X.translateCoordinate(se,X.coordsAxis,X.coordsClient),n=Z.getBoundingClientRect();q.style.left=`${Math.max(s.clientX-(290+n.left),10)}px`,q.style.top=`${Math.max(s.clientY-(210+n.top),10)}px`,q.style.opacity="1.0",J.engine.layout();const a=30,i=e[se.countryCode],r=t.find((e=>e.iso_code===se.countryCode)),l=o.find((e=>e.cca3===se.countryCode));ee.setText(`${l.name.common} previous 4 weeks`);const c=V(new Date(y.getTime()-24*a*60*60*1e3),y),d=i.data.filter((e=>c(e.date))),u=r.data.filter((e=>c(e.date)));for(const t of Object.keys(oe)){const{series:o,valueLabel:s,dataSet:n,format:a}=oe[t],i=n===e?d:u,r=i.map((e=>({x:Y(e.date),y:void 0!==e[t]?e[t]:NaN}))).filter((e=>!Number.isNaN(e.y)));let l;o.clear().add(r);for(let e=r.length-1;e>=0&&(l=r[e],Number.isNaN(l.y));e-=1);if(s.setText(""),void 0!==l){let e;for(let t=i.length-1;t>=0&&(e=a(i[t]),!e);t-=1);if(e){const t={x:l.x,y:l.y};s.setText(e).setPosition(t)}}}ne=se.countryCode}se=void 0,ne||(q.style.opacity="0.0")}),1e3/60);U(X.onSeriesBackgroundMouseClick.bind(X),X.onSeriesBackgroundMouseDoubleClick.bind(X),(e=>{if(window.performance.now()-M<750)return;const t=X.translateCoordinate(e,X.coordsRelative),o=X.getSizePixels(),s=t.x/o.x,n=t.y/o.y,a=B[i]||[];for(const e of a)if(s>=e.boundary.bottomLeft.x&&s<=e.boundary.topRight.x&&n>=e.boundary.bottomLeft.y&&n<=e.boundary.topRight.y)return le(),void I(e.mapType);ae&&(le(),E(ae,i,R))}),(e=>{window.performance.now()-M>2e3&&"World"!==i&&(le(),I("World"))}));const re=z.onMouseClick(((e,t)=>{"World"!==i&&window.performance.now()-M>500&&(le(),I("World"))}));let le=()=>{clearInterval(ie),clearInterval(W),C.dispose(),X.dispose(),J.dispose(),q.remove(),z.offMouseClick(re),le=()=>{}}},E=(r,l,d)=>{s&&s.deactivate(),L.setVisible(!1),N.setVisible(!0),z.setVisible(!0);const p=e[r],g=t.find((e=>e.iso_code===r)),m=o.find((e=>e.cca3===r)),y=(e,t,o,s,n,a)=>({property:e,dataSet:t,title:o,titleY:s,maxY:n,format:a}),h=[y("people_vaccinated_per_hundred",g,"Vaccination rate (at least 1 vaccine)","Vaccinated (%)",100,(e=>`${e.toFixed(1)}% received at least 1 vaccine`)),y(d?"new_cases_per_million":"new_cases",p,d?"New cases (relative to population)":"New cases",d?"per 1 million citizens":"New cases",d?1e3:void 0,d?e=>`${e.toFixed(0)} new cases per 1 million citizens`:e=>`${e.toFixed(0)} new cases`),y(d?"hosp_patients_per_million":"hosp_patients",p,d?"Hospital patients (relative to population)":"Hospital patients",d?"per 1 million citizens":"Hospital patients",d?100:void 0,d?e=>`${e.toFixed(0)} hospital patients per 1 million citizens`:e=>`${e.toFixed(0)} hospital patients`),y(d?"icu_patients_per_million":"icu_patients",p,d?"Intensive hospital care patients (relative to population)":"Intensive hospital care patients",d?"per 1 million citizens":"Intensive care patients",d?50:void 0,d?e=>`${e.toFixed(0)} intensive care patients per 1 million citizens`:e=>`${e.toFixed(0)} intensive care patients`)].map(((e,t,o)=>{const s=F.createChartXY({columnIndex:0,rowIndex:t}).setTitle(e.title).setPadding({left:0});if(0===t){const e=s.addUIElement(u.TextBox,s.coordsRelative).setText(`${m.name.common}`).setTextFont((e=>e.setSize(22))).setBackground((e=>e.setFillStyle(x).setStrokeStyle(f)));s.onResize((()=>{e.setPosition({x:140,y:s.getSizePixels().y}).setOrigin(T.LeftTop)}));const t=s.addUIElement(u.TextBox).setPosition({x:100,y:100}).setOrigin(T.RightTop).setMargin({top:14,right:24}).setDraggingMode(C.notDraggable);t.onMouseEnter((e=>s.engine.setMouseStyle(k.Point))),t.onMouseLeave((e=>s.engine.setMouseStyle(k.Default)));const o=e=>{e!==R&&(R=e,_(),E(r,l,e)),t.setText(e?"Show actual values":"Show relative values")};t.onMouseClick((e=>o(!R))),o(R)}const d=s.getDefaultAxisX().setAnimationScroll(!1);t<o.length-1?d.setMouseInteractions(!1).setThickness(0).setStrokeStyle(f).setTickStrategy(a.DateTime,(e=>e.setGreatTickStyle(i).setMajorTickStyle((e=>e.setLabelFillStyle(w).setTickStyle(f))).setMinorTickStyle((e=>e.setLabelFillStyle(w).setTickStyle(f))))):d.setTickStrategy(a.DateTime);const p=s.getDefaultAxisY().setTitle(e.titleY||"").setTitleFont((e=>e.setSize(12))).setThickness({min:80});void 0!==e.maxY&&p.setInterval({start:0,end:e.maxY,stopAxisAfter:!1}).setScrollStrategy(n.expansion);const g=s.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName(`${m.name.common}`).setCursorInterpolationEnabled(!1).setCursorResultTableFormatter(((t,o,s,n,a)=>t.addRow(`${m.name.common}`).addRow(d.formatValue(a.x)).addRow(e.format(n)))),y=e.dataSet.data.map((t=>({x:Y(t.date),y:t[e.property]}))).filter((e=>void 0!==e.y&&e.x>=c));g.add(y);const h=X&&X[e.property];let S;if(h){S=s.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName("Global average").setCursorInterpolationEnabled(!1).setCursorResultTableFormatter(((t,o,s,n,a)=>t.addRow("Global average").addRow(d.formatValue(a.x)).addRow(e.format(n)))).add(h);const t=g.getStrokeStyle();S.setStrokeStyle(t.setFillStyle(t.getFillStyle().setA(100)))}return{...e,chart:s,series:g,seriesAverage:S}}));v(...h.map((e=>e.chart.getDefaultAxisX())));for(let e=0;e<4;e+=1)F.setRowHeight(e,e<h.length?1:0);const S=()=>{_&&_(),I(l)};h.forEach((e=>{U(e.chart.onSeriesBackgroundMouseClick.bind(e.chart),e.chart.onSeriesBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),S),U(e.chart.onBackgroundMouseClick.bind(e.chart),e.chart.onBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),S)}));const b=z.onMouseClick((()=>S()));let _=()=>{h.forEach((e=>{e.chart.dispose()})),z.offMouseClick(b),_=void 0};M=window.performance.now()};let X;console.time("calculate global averages"),X={new_cases_per_million:[],hosp_patients_per_million:[],icu_patients_per_million:[]};for(const t of Object.keys(X)){const o=new Map;for(const s of Object.keys(e)){const n=e[s];if(n)for(let e=0;e<n.data.length;e+=1){const s=n.data[e],a=s[t];if(void 0!==a){const e=o.get(s.date);e?(e.count+=1,e.sum+=a):o.set(s.date,{count:1,sum:a})}}}const s=Array.from(o.entries()).map((([e,t])=>({x:Y(e),y:t.sum/t.count}))).sort(((e,t)=>e.x-t.x)).filter((e=>e.x>=c));X[t]=s}console.timeEnd("calculate global averages"),I("World")})();const V=(e,t)=>{const o=e.getFullYear(),s=e.getMonth(),n=e.getDate(),a=t.getFullYear(),i=t.getMonth(),r=t.getDate(),l=372*o+31*s+n,c=372*a+31*i+r;return e=>{const t=372*Number(e.substring(0,4))+31*(Number(e.substring(5,7))-1)+Number(e.substring(8,10));return t>=l&&t<=c}},Y=e=>{const t=Number(e.substring(0,4)),o=Number(e.substring(5,7))-1,s=Number(e.substring(8,10));return new Date(t,o,s).getTime()},$=e=>`${e.getFullYear()}-${X(e.getMonth()+1,2)}-${X(e.getDate(),2)}`,X=(e,t)=>{let o=String(e);for(;o.length<t;)o=`0${o}`;return o},U=(e,t,o,s)=>{let n=0;e(((e,t)=>{setTimeout((()=>{window.performance.now()-n>=500&&o(t)}),200)})),t(((e,t)=>{n=window.performance.now(),s(t)}))},O=(e,t,o)=>Math.min(Math.max(e,t),o)}},e=>{e.O(0,[502],(()=>(44,e(e.s=44)))),e.O()}]);