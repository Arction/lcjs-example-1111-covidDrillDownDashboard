(self.webpackChunk=self.webpackChunk||[]).push([[143],{138:(e,t,o)=>{const n=o(475),{AxisScrollStrategies:s,AxisTickStrategies:i,emptyTick:a,AutoCursorModes:l,FormattingFunctions:r,LUT:c,lightningChart:d,UIElementBuilders:u,UILayoutBuilders:g,PointShape:p,ColorCSS:m,ColorRGBA:y,emptyFill:x,PalettedFill:S,SolidFill:h,emptyLine:f,synchronizeAxisIntervals:b,translatePoint:v,transparentFill:w,UIOrigins:T,MouseStyles:k,SolidLine:_,UIDraggingModes:M,Themes:C,regularColorSteps:I}=n,F=d().Dashboard({numberOfColumns:1,numberOfRows:4}),A=F.getTheme();let D=!0;const P=new c({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...I(0,1e3,A.examples.badGoodColorPalette.reverse())]}),R=new c({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...I(0,100,A.examples.badGoodColorPalette.reverse())]}),B={World:[{mapType:"NorthAmerica",boundary:{bottomLeft:{x:4,y:52},topRight:{x:44,y:93}}},{mapType:"SouthAmerica",boundary:{bottomLeft:{x:16,y:14},topRight:{x:45,y:50}}},{mapType:"Europe",boundary:{bottomLeft:{x:45,y:64},topRight:{x:60,y:93}}},{mapType:"Africa",boundary:{bottomLeft:{x:46,y:15},topRight:{x:63,y:64}}},{mapType:"Asia",boundary:{bottomLeft:{x:59,y:40},topRight:{x:95,y:91}}}]},E=F.addUIElement(g.Column,F.uiScale).setOrigin(T.RightTop).setPosition(v({x:F.engine.container.getBoundingClientRect().width-8,y:F.engine.container.getBoundingClientRect().height-40},F.engine.scale,F.uiScale)).setBackground((e=>e.setFillStyle(x).setStrokeStyle(f))),L=E.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Left click to drill down at mouse location"),N=E.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Double left click to zoom out"),Y=F.addUIElement(u.TextBox,F.uiScale).setOrigin(T.LeftTop).setPosition(v({x:8,y:F.engine.container.getBoundingClientRect().height-8},F.engine.scale,F.uiScale)).setText("Zoom out").setTextFont((e=>e.setSize(20))).setDraggingMode(M.notDraggable).setMouseStyle(k.Point);(async()=>{let e,t,o,n;await Promise.all([new Promise((async t=>{console.time("loading covid data"),e=await fetch(document.head.baseURI+"examples/assets/1111/owid-covid-data.json").then((e=>e.json())),console.timeEnd("loading covid data"),t()})),new Promise((async e=>{console.time("loading covid vaccinations data"),t=await fetch(document.head.baseURI+"examples/assets/1111/vaccinations.json").then((e=>e.json())),console.timeEnd("loading covid vaccinations data"),e()})),new Promise((async e=>{console.time("loading country locations data"),o=await fetch(document.head.baseURI+"examples/assets/1111/countries.json").then((e=>e.json())),console.timeEnd("loading country locations data"),e()}))]);const c=new Date(2020,10,1).getTime();let y=new Date(2022,2,11),C=X(e.FIN.data[e.FIN.data.length-1].date),I=0;const E=async a=>{I=window.performance.now(),n=n||(()=>{console.time("calculate new cases history");const o=new Map,s=new Map;for(const n of Object.keys(e)){const i=e[n];for(let e=0;e<i.data.length;e+=1){const t=i.data[e],n=t.new_cases;if(void 0!==n){const e=o.get(t.date);e?o.set(t.date,e+n):o.set(t.date,n)}}const a=t.find((e=>e.iso_code===n));for(let e=0;e<a.data.length;e+=1){const t=a.data[e],o=t.people_vaccinated_per_hundred;if(void 0!==o){const e=s.get(t.date);e?(e.count+=1,e.sum+=o):s.set(t.date,{count:1,sum:o})}}}const a=Array.from(o.entries()).map((([e,t])=>({x:X(e),y:t}))).filter((e=>e.x>=c)).sort(((e,t)=>e.x-t.x)),d=Array.from(s.entries()).map((([e,t])=>({x:X(e),y:t.sum/t.count}))).filter((e=>e.x>=c)).sort(((e,t)=>e.x-t.x));o.clear(),s.clear();const g=F.createChartXY({columnIndex:0,rowIndex:1}).setTitle("Global CoVID daily new cases history").setAutoCursorMode(l.disabled).setMouseInteractions(!1),p=g.addAxisX({opposite:!0}).setTickStrategy(i.Empty).setStrokeStyle(f).setMouseInteractions(!1),m=p.addCustomTick(u.PointableTextBox).setMouseInteractions(!0).setAllocatesAxisSpace(!1).setTextFormatter((e=>new Date(e).toLocaleDateString("fin",{})));b(g.getDefaultAxisX(),p),g.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setCursorInterpolationEnabled(!1).add(a),g.getDefaultAxisY().setMouseInteractions(!1).setTitle("New daily cases").setTitleFont((e=>e.setSize(12))).setTickStrategy(i.Numeric,(e=>e.setFormattingFunction(r.NumericUnits))).fit(!1);const y=g.addAxisY({opposite:!0}).setTitle("Vaccinated once (%)").setTitleFont((e=>e.setSize(12))).setMouseInteractions(!1).setInterval({start:0,end:100});return g.addLineSeries({dataPattern:{pattern:"ProgressiveX"},yAxis:y}).setCursorInterpolationEnabled(!1).add(d).setStrokeStyle(new _({thickness:2,fillStyle:new S({lookUpProperty:"y",lut:R})})),g.getDefaultAxisX().setTickStrategy(i.DateTime).setMouseInteractions(!1).fit(!1),m.onMouseDrag(((e,t)=>{const o=g.engine.clientLocation2Engine(t.clientX,t.clientY),s=v(o,g.engine.scale,{x:g.getDefaultAxisX(),y:g.getDefaultAxisY()}),i=Math.min(Math.max(s.x,c),C);m.setValue(i),n.onChange&&n.onChange(i)})),m.onMouseEnter(((e,t)=>{g.engine.setMouseStyle(k.Horizontal)})),m.onMouseLeave(((e,t)=>{g.engine.setMouseStyle(k.Default)})),console.timeEnd("calculate new cases history"),n={chart:g,highlighter:m,onChange:()=>{},deactivate:()=>{g.dispose(),n=void 0}},n})(),L.setVisible(!0),"World"!==a?(N.setVisible(!0),Y.setVisible(!0)):(N.setVisible(!1),Y.setVisible(!1)),F.setRowHeight(0,4).setRowHeight(1,1);for(let e=2;e<4;e+=1)F.setRowHeight(e,0);const M=F.createMapChart({columnIndex:0,rowIndex:0,type:a}).setAutoCursorMode(l.disabled).setMouseInteractions(!1).setPadding({top:40}),j=F.createChartXY({columnIndex:0,rowIndex:0}).setTitle("").setBackgroundFillStyle(w).setSeriesBackgroundFillStyle(w).setSeriesBackgroundStrokeStyle(f).setAutoCursorMode(l.disabled).setMouseInteractions(!1);j.forEachAxis((e=>e.setTickStrategy(i.Empty).setStrokeStyle(f))),M.onViewChange((e=>{j.setPadding({left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom}),j.getDefaultAxisX().setInterval({start:e.longitudeRange.start,end:e.longitudeRange.end}),j.getDefaultAxisY().setInterval({start:e.latitudeRange.start,end:e.latitudeRange.end})})),M.setFillStyle(new S({lut:R}));const H=j.addPointSeries({pointShape:p.Circle}).setIndividualPointSizeEnabled(!0).setIndividualPointValueEnabled(!0).setPointFillStyle(new S({lut:P})).setMouseInteractions(!1),W=(s,i=!1)=>{y=s;const l=s.getTime(),r=z(s);M.setTitle(`CoVID vaccinations & new cases | ${s.toLocaleDateString("fin",{})}`),H.clear(),M.invalidateRegionValues(((n,s)=>{const i=n.ISO_A3,c=e[i],d=t.find((e=>e.iso_code===i)),u=o.find((e=>e.cca3===i));if(c&&d&&u){const e=c.data.find((e=>e.date===r)),t=e&&e.new_cases_smoothed_per_million;let o;for(let e=d.data.length-1;e>=0;e-=1){const t=d.data[e];if(void 0!==t.people_vaccinated_per_hundred&&X(t.date)<=l){o=t.people_vaccinated_per_hundred;break}}if(void 0!==t&&void 0!==o){const e=u.latlng[0],n=u.latlng[1],s=0===t?0:U(25*t/1e3,"World"===a?1:5,25);return H.add({countryCode:i,smoothedNewCasesPerMillion:t,peopleVaccinatedPerHundred:o,x:n,y:e,value:t,size:s}),o}}return-1})),i&&n&&n.highlighter.setValue(s.getTime())};let G;W(y,!0),n.onChange=e=>{G=new Date(e)};const Z=setInterval((()=>{G&&(W(G),G=void 0)}),1e3/60),q=document.getElementById("chart-container")||document.body,J=document.createElement("div");q.append(J);const K=d().ChartXY({container:J,theme:A}).setTitle("").setPadding({left:0,bottom:0,right:0,top:14}).setMouseInteractions(!1).setBackgroundFillStyle(A.cursorResultTableFillStyle);K.setBackgroundFillStyle(x).setBackgroundStrokeStyle(f).setSeriesBackgroundFillStyle(x).setSeriesBackgroundStrokeStyle(f),K.engine.setBackgroundFillStyle(x),K.getDefaultAxisY().dispose(),K.getDefaultAxisX().setAnimationScroll(!1);const Q=K.addUIElement(g.Column).setPosition({x:0,y:100}).setOrigin(T.LeftTop).setBackground((e=>e.setStrokeStyle(f).setFillStyle(x))),ee=e=>Q.addElement(u.TextBox).setText(e),te=ee("");A.isDark||te.setTextFillStyle(new h({color:m("rgb(255,255,255)")}));const oe=(e,t,o,n,i)=>{const a=new h({color:m(e)}),l=K.addAxisY().setInterval({start:0,end:o,stopAxisAfter:!1}).setScrollStrategy(s.expansion);return{series:K.addLineSeries({yAxis:l,dataPattern:{pattern:"ProgressiveX"}}).setCursorInterpolationEnabled(!1).setStrokeStyle((e=>e.setFillStyle(a))),label:ee(t).setTextFillStyle(a),valueLabel:K.addUIElement(u.TextBox,{x:K.getDefaultAxisX(),y:l}).setOrigin(T.RightBottom).setTextFillStyle(a).setText("").setBackground((e=>e.setStrokeStyle(f).setFillStyle(x))),format:n,dataSet:i}},ne={people_vaccinated_per_hundred:oe("rgb(0, 255, 0)","Vaccinations",100,(e=>void 0!==e.people_vaccinated_per_hundred?`${e.people_vaccinated_per_hundred.toFixed(1)}%`:void 0),t),new_cases_per_million:oe("rgb(255, 255, 0)","New cases",1e3,(e=>void 0!==e.new_cases?String(e.new_cases):void 0),e),hosp_patients_per_million:oe("rgb(255, 127, 0)","Hospitalized",100,(e=>void 0!==e.hosp_patients?String(e.hosp_patients):void 0),e),icu_patients_per_million:oe("rgb(255, 0, 0)","Severe cases",50,(e=>void 0!==e.icu_patients?String(e.icu_patients):void 0),e)};let se,ie,ae;J.style.position="absolute",J.style.top="0px",J.style.backgroundColor="rgba(0,0,0,0.7)",J.style.border="solid 8px transparent",J.style.borderRadius="16px",J.style.width="280px",J.style.height="200px",J.style.transition="left 0.2s, top 0.2s, opacity 0.5s",J.style.opacity="0.0",J.style.pointerEvents="none",K.forEachAxis((e=>e.setTickStrategy(i.Empty).setStrokeStyle(f).setMouseInteractions(!1))),M.onMapDataReady((()=>{setTimeout((()=>{se={countryCode:"ITA",x:12.83,y:42.83}}),500)})),j.onSeriesBackgroundMouseMove(((e,t)=>{const o=H.solveNearestFromScreen(j.engine.clientLocation2Engine(t.clientX,t.clientY));o&&(se=o.location,ae=se.countryCode)})),j.onSeriesBackgroundMouseLeave((()=>{ie=void 0,se=void 0}));const le=setInterval((()=>{if(se&&se.countryCode!==ie){const n=v({x:se.x,y:se.y},{x:j.getDefaultAxisX(),y:j.getDefaultAxisY()},j.engine.scale),s=j.engine.engineLocation2Client(n.x,n.y),i=q.getBoundingClientRect();J.style.left=`${Math.max(s.x-(290+i.left),10)}px`,J.style.top=`${Math.max(s.y-(210+i.top),10)}px`,J.style.opacity="1.0",K.engine.layout();const a=30,l=e[se.countryCode],r=t.find((e=>e.iso_code===se.countryCode)),c=o.find((e=>e.cca3===se.countryCode));te.setText(`${c.name.common} previous 4 weeks`);const d=V(new Date(y.getTime()-24*a*60*60*1e3),y),u=l.data.filter((e=>d(e.date))),g=r.data.filter((e=>d(e.date)));for(const t of Object.keys(ne)){const{series:o,valueLabel:n,dataSet:s,format:i}=ne[t],a=s===e?u:g,l=a.map((e=>({x:X(e.date),y:void 0!==e[t]?e[t]:NaN}))).filter((e=>!Number.isNaN(e.y)));let r;o.clear().add(l);for(let e=l.length-1;e>=0&&(r=l[e],Number.isNaN(r.y));e-=1);if(n.setText(""),void 0!==r){let e;for(let t=a.length-1;t>=0&&(e=i(a[t]),!e);t-=1);if(e){const t={x:r.x,y:r.y};n.setText(e).setPosition(t)}}}ie=se.countryCode}se=void 0,ie||(J.style.opacity="0.0")}),1e3/60);O(j.onSeriesBackgroundMouseClick.bind(j),j.onSeriesBackgroundMouseDoubleClick.bind(j),(e=>{if(window.performance.now()-I<750)return;const t=j.engine.clientLocation2Engine(e.clientX,e.clientY),o=v(t,j.engine.scale,j.uiScale),n=B[a]||[];for(const e of n)if(o.x>=e.boundary.bottomLeft.x&&o.x<=e.boundary.topRight.x&&o.y>=e.boundary.bottomLeft.y&&o.y<=e.boundary.topRight.y)return ce(),void E(e.mapType);ae&&(ce(),$(ae,a,D))}),(e=>{window.performance.now()-I>2e3&&"World"!==a&&(ce(),E("World"))}));const re=Y.onMouseClick(((e,t)=>{"World"!==a&&window.performance.now()-I>500&&(ce(),E("World"))}));let ce=()=>{clearInterval(le),clearInterval(Z),M.dispose(),j.dispose(),K.dispose(),J.remove(),Y.offMouseClick(re),ce=()=>{}}},$=(l,r,d)=>{n&&n.deactivate(),L.setVisible(!1),N.setVisible(!0),Y.setVisible(!0);const g=e[l],p=t.find((e=>e.iso_code===l)),m=o.find((e=>e.cca3===l)),y=(e,t,o,n,s,i)=>({property:e,dataSet:t,title:o,titleY:n,maxY:s,format:i}),S=[y("people_vaccinated_per_hundred",p,"Vaccination rate (at least 1 vaccine)","Vaccinated (%)",100,(e=>`${e.toFixed(1)}% received at least 1 vaccine`)),y(d?"new_cases_per_million":"new_cases",g,d?"New cases (relative to population)":"New cases",d?"per 1 million citizens":"New cases",d?1e3:void 0,d?e=>`${e.toFixed(0)} new cases per 1 million citizens`:e=>`${e.toFixed(0)} new cases`),y(d?"hosp_patients_per_million":"hosp_patients",g,d?"Hospital patients (relative to population)":"Hospital patients",d?"per 1 million citizens":"Hospital patients",d?100:void 0,d?e=>`${e.toFixed(0)} hospital patients per 1 million citizens`:e=>`${e.toFixed(0)} hospital patients`),y(d?"icu_patients_per_million":"icu_patients",g,d?"Intensive hospital care patients (relative to population)":"Intensive hospital care patients",d?"per 1 million citizens":"Intensive care patients",d?50:void 0,d?e=>`${e.toFixed(0)} intensive care patients per 1 million citizens`:e=>`${e.toFixed(0)} intensive care patients`)].map(((e,t,o)=>{const n=F.createChartXY({columnIndex:0,rowIndex:t}).setTitle(e.title).setPadding({left:0});if(0===t){n.addUIElement(u.TextBox).setPosition({x:0,y:100}).setMargin({left:140,top:n.getTitleMargin().top}).setOrigin(T.LeftTop).setText(`${m.name.common}`).setTextFont((e=>e.setSize(22))).setBackground((e=>e.setFillStyle(x).setStrokeStyle(f)));const e=n.addUIElement(u.TextBox).setPosition({x:100,y:100}).setOrigin(T.RightTop).setMargin({top:14,right:24}).setDraggingMode(M.notDraggable);e.onMouseEnter((e=>n.engine.setMouseStyle(k.Point))),e.onMouseLeave((e=>n.engine.setMouseStyle(k.Default)));const t=t=>{t!==D&&(D=t,_(),$(l,r,t)),e.setText(t?"Show actual values":"Show relative values")};e.onMouseClick((e=>t(!D))),t(D)}const d=n.getDefaultAxisX().setAnimationScroll(!1);t<o.length-1?d.setMouseInteractions(!1).setThickness(0).setStrokeStyle(f).setTickStrategy(i.DateTime,(e=>e.setGreatTickStyle(a).setMajorTickStyle((e=>e.setLabelFillStyle(w).setTickStyle(f))).setMinorTickStyle((e=>e.setLabelFillStyle(w).setTickStyle(f))))):d.setTickStrategy(i.DateTime);const g=n.getDefaultAxisY().setTitle(e.titleY||"").setTitleFont((e=>e.setSize(12))).setThickness({min:80});void 0!==e.maxY&&g.setInterval({start:0,end:e.maxY,stopAxisAfter:!1}).setScrollStrategy(s.expansion);const p=n.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName(`${m.name.common}`).setCursorInterpolationEnabled(!1).setCursorResultTableFormatter(((t,o,n,s,i)=>t.addRow(`${m.name.common}`).addRow(d.formatValue(i.x)).addRow(e.format(s)))),y=e.dataSet.data.map((t=>({x:X(t.date),y:t[e.property]}))).filter((e=>void 0!==e.y&&e.x>=c));p.add(y);const S=j&&j[e.property];let h;if(S){h=n.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName("Global average").setCursorInterpolationEnabled(!1).setCursorResultTableFormatter(((t,o,n,s,i)=>t.addRow("Global average").addRow(d.formatValue(i.x)).addRow(e.format(s)))).add(S);const t=p.getStrokeStyle();h.setStrokeStyle(t.setFillStyle(t.getFillStyle().setA(100)))}return{...e,chart:n,series:p,seriesAverage:h}}));b(...S.map((e=>e.chart.getDefaultAxisX())));for(let e=0;e<4;e+=1)F.setRowHeight(e,e<S.length?1:0);const h=()=>{_&&_(),E(r)};S.forEach((e=>{O(e.chart.onSeriesBackgroundMouseClick.bind(e.chart),e.chart.onSeriesBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),h),O(e.chart.onBackgroundMouseClick.bind(e.chart),e.chart.onBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),h)}));const v=Y.onMouseClick((()=>h()));let _=()=>{S.forEach((e=>{e.chart.dispose()})),Y.offMouseClick(v),_=void 0};I=window.performance.now()};let j;console.time("calculate global averages"),j={new_cases_per_million:[],hosp_patients_per_million:[],icu_patients_per_million:[]};for(const t of Object.keys(j)){const o=new Map;for(const n of Object.keys(e)){const s=e[n];if(s)for(let e=0;e<s.data.length;e+=1){const n=s.data[e],i=n[t];if(void 0!==i){const e=o.get(n.date);e?(e.count+=1,e.sum+=i):o.set(n.date,{count:1,sum:i})}}}const n=Array.from(o.entries()).map((([e,t])=>({x:X(e),y:t.sum/t.count}))).sort(((e,t)=>e.x-t.x)).filter((e=>e.x>=c));j[t]=n}console.timeEnd("calculate global averages"),E("World")})();const V=(e,t)=>{const o=e.getFullYear(),n=e.getMonth(),s=e.getDate(),i=t.getFullYear(),a=t.getMonth(),l=t.getDate(),r=372*o+31*n+s,c=372*i+31*a+l;return e=>{const t=372*Number(e.substring(0,4))+31*(Number(e.substring(5,7))-1)+Number(e.substring(8,10));return t>=r&&t<=c}},X=e=>{const t=Number(e.substring(0,4)),o=Number(e.substring(5,7))-1,n=Number(e.substring(8,10));return new Date(t,o,n).getTime()},z=e=>`${e.getFullYear()}-${$(e.getMonth()+1,2)}-${$(e.getDate(),2)}`,$=(e,t)=>{let o=String(e);for(;o.length<t;)o=`0${o}`;return o},O=(e,t,o,n)=>{let s=0;e(((e,t)=>{setTimeout((()=>{window.performance.now()-s>=500&&o(t)}),200)})),t(((e,t)=>{s=window.performance.now(),n(t)}))},U=(e,t,o)=>Math.min(Math.max(e,t),o)}},e=>{e.O(0,[736],(()=>(138,e(e.s=138)))),e.O()}]);