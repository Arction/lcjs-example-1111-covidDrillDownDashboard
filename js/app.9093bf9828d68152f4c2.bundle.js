(self.webpackChunk=self.webpackChunk||[]).push([[524],{44:(e,t,o)=>{const s=o(89),{AxisScrollStrategies:n,AxisTickStrategies:a,emptyTick:i,AutoCursorModes:r,FormattingFunctions:l,LUT:d,lightningChart:c,UIElementBuilders:u,UILayoutBuilders:p,PointShape:g,ColorCSS:m,ColorRGBA:y,emptyFill:h,PalettedFill:x,SolidFill:S,emptyLine:f,synchronizeAxisIntervals:b,translatePoint:v,transparentFill:w,UIOrigins:T,MouseStyles:k,SolidLine:_,UIDraggingModes:I,Themes:C,regularColorSteps:M}=s,R=c({resourcesBaseUrl:new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"resources/"}).Dashboard({numberOfColumns:1,numberOfRows:4,theme:C[new URLSearchParams(window.location.search).get("theme")||"darkGold"]||void 0}),F=R.getTheme();let A=!0;const D=new d({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...M(0,1e3,F.examples.badGoodColorPalette.reverse())]}),P=new d({interpolate:!0,steps:[{value:-1,color:y(0,0,0)},{value:-.1,color:y(0,0,0)},...M(0,100,F.examples.badGoodColorPalette.reverse())]}),L={World:[{mapType:"NorthAmerica",boundary:{bottomLeft:{x:.04,y:.52},topRight:{x:.44,y:.93}}},{mapType:"SouthAmerica",boundary:{bottomLeft:{x:.16,y:.14},topRight:{x:.45,y:.5}}},{mapType:"Europe",boundary:{bottomLeft:{x:.45,y:.64},topRight:{x:.6,y:.93}}},{mapType:"Africa",boundary:{bottomLeft:{x:.46,y:.15},topRight:{x:.63,y:.64}}},{mapType:"Asia",boundary:{bottomLeft:{x:.59,y:.4},topRight:{x:.95,y:.91}}}]},B=R.addUIElement(p.Column,R.coordsRelative).setOrigin(T.RightTop).setBackground((e=>e.setFillStyle(h).setStrokeStyle(f))),E=B.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Left click to drill down at mouse location"),U=B.addElement(u.TextBox).setTextFont((e=>e.setSize(10))).setText("Double left click to zoom out"),N=R.addUIElement(u.TextBox,R.coordsRelative).setOrigin(T.LeftTop).setText("Zoom out").setTextFont((e=>e.setSize(20))).setDraggingMode(I.notDraggable).setMouseStyle(k.Point);R.onResize((()=>{const e=R.engine.container.getBoundingClientRect();B.setPosition({x:e.width-8,y:e.height-40}),N.setPosition({x:8,y:e.height-8})})),(async()=>{let e,t,o,s;await Promise.all([new Promise((async t=>{console.time("loading covid data"),e=await fetch(new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"examples/assets/1111/owid-covid-data.json").then((e=>e.json())),console.timeEnd("loading covid data"),t()})),new Promise((async e=>{console.time("loading covid vaccinations data"),t=await fetch(new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"examples/assets/1111/vaccinations.json").then((e=>e.json())),console.timeEnd("loading covid vaccinations data"),e()})),new Promise((async e=>{console.time("loading country locations data"),o=await fetch(new URL(document.head.baseURI).origin+new URL(document.head.baseURI).pathname+"examples/assets/1111/countries.json").then((e=>e.json())),console.timeEnd("loading country locations data"),e()}))]);const d=new Date(2020,10,1).getTime();let y=new Date(2022,2,11),v=V(e.FIN.data[e.FIN.data.length-1].date),C=0;const M=async i=>{C=window.performance.now(),s=s||(()=>{console.time("calculate new cases history");const o=new Map,n=new Map;for(const s of Object.keys(e)){const a=e[s];for(let e=0;e<a.data.length;e+=1){const t=a.data[e],s=t.new_cases;if(void 0!==s){const e=o.get(t.date);e?o.set(t.date,e+s):o.set(t.date,s)}}const i=t.find((e=>e.iso_code===s));for(let e=0;e<i.data.length;e+=1){const t=i.data[e],o=t.people_vaccinated_per_hundred;if(void 0!==o){const e=n.get(t.date);e?(e.count+=1,e.sum+=o):n.set(t.date,{count:1,sum:o})}}}const i=Array.from(o.entries()).map((([e,t])=>({x:V(e),y:t}))).filter((e=>e.x>=d)).sort(((e,t)=>e.x-t.x)),c=Array.from(n.entries()).map((([e,t])=>({x:V(e),y:t.sum/t.count}))).filter((e=>e.x>=d)).sort(((e,t)=>e.x-t.x));o.clear(),n.clear();const p=R.createChartXY({columnIndex:0,rowIndex:1}).setTitle("Global CoVID daily new cases history").setAutoCursorMode(r.disabled).setMouseInteractions(!1),g=p.addAxisX({opposite:!0}).setTickStrategy(a.Empty).setStrokeStyle(f).setMouseInteractions(!1),m=g.addCustomTick(u.PointableTextBox).setMouseInteractions(!0).setAllocatesAxisSpace(!1).setTextFormatter((e=>new Date(e).toLocaleDateString("fin",{})));b(p.getDefaultAxisX(),g),p.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setCursorInterpolationEnabled(!1).add(i),p.getDefaultAxisY().setMouseInteractions(!1).setTitle("New daily cases").setTitleFont((e=>e.setSize(12))).setTickStrategy(a.Numeric,(e=>e.setFormattingFunction(l.NumericUnits))).fit(!1);const y=p.addAxisY({opposite:!0}).setTitle("Vaccinated once (%)").setTitleFont((e=>e.setSize(12))).setMouseInteractions(!1).setInterval({start:0,end:100});return p.addLineSeries({dataPattern:{pattern:"ProgressiveX"},yAxis:y}).setCursorInterpolationEnabled(!1).add(c).setStrokeStyle(new _({thickness:2,fillStyle:new x({lookUpProperty:"y",lut:P})})),p.getDefaultAxisX().setTickStrategy(a.DateTime).setMouseInteractions(!1).fit(!1),m.onMouseDrag(((e,t)=>{const o=p.translateCoordinate(t,p.coordsAxis),n=Math.min(Math.max(o.x,d),v);m.setValue(n),s.onChange&&s.onChange(n)})),m.onMouseEnter(((e,t)=>{p.engine.setMouseStyle(k.Horizontal)})),m.onMouseLeave(((e,t)=>{p.engine.setMouseStyle(k.Default)})),console.timeEnd("calculate new cases history"),s={chart:p,highlighter:m,onChange:()=>{},deactivate:()=>{p.dispose(),s=void 0}},s})(),E.setVisible(!0),"World"!==i?(U.setVisible(!0),N.setVisible(!0)):(U.setVisible(!1),N.setVisible(!1)),R.setRowHeight(0,4).setRowHeight(1,1);for(let e=2;e<4;e+=1)R.setRowHeight(e,0);const I=R.createMapChart({columnIndex:0,rowIndex:0,type:i}).setAutoCursorMode(r.disabled).setMouseInteractions(!1).setPadding({top:40}),$=R.createChartXY({columnIndex:0,rowIndex:0}).setTitle("").setBackgroundFillStyle(w).setSeriesBackgroundFillStyle(w).setSeriesBackgroundStrokeStyle(f).setAutoCursorMode(r.disabled).setMouseInteractions(!1);$.forEachAxis((e=>e.setTickStrategy(a.Empty).setStrokeStyle(f))),I.onViewChange((e=>{$.setPadding({left:e.margin.left,right:e.margin.right,top:e.margin.top,bottom:e.margin.bottom}),$.getDefaultAxisX().setInterval({start:e.longitudeRange.start,end:e.longitudeRange.end}),$.getDefaultAxisY().setInterval({start:e.latitudeRange.start,end:e.latitudeRange.end})})),I.setFillStyle(new x({lut:P}));const j=$.addPointSeries({pointShape:g.Circle}).setIndividualPointSizeEnabled(!0).setIndividualPointValueEnabled(!0).setPointFillStyle(new x({lut:D})).setMouseInteractions(!1),H=(n,a=!1)=>{y=n;const r=n.getTime(),l=Y(n);I.setTitle(`CoVID vaccinations & new cases | ${n.toLocaleDateString("fin",{})}`),j.clear(),I.invalidateRegionValues(((s,n)=>{const a=s.ISO_A3,d=e[a],c=t.find((e=>e.iso_code===a)),u=o.find((e=>e.cca3===a));if(d&&c&&u){const e=d.data.find((e=>e.date===l)),t=e&&e.new_cases_smoothed_per_million;let o;for(let e=c.data.length-1;e>=0;e-=1){const t=c.data[e];if(void 0!==t.people_vaccinated_per_hundred&&V(t.date)<=r){o=t.people_vaccinated_per_hundred;break}}if(void 0!==t&&void 0!==o){const e=u.latlng[0],s=u.latlng[1],n=0===t?0:O(25*t/1e3,"World"===i?1:5,25);return j.add({countryCode:a,smoothedNewCasesPerMillion:t,peopleVaccinatedPerHundred:o,x:s,y:e,value:t,size:n}),o}}return-1})),a&&s&&s.highlighter.setValue(n.getTime())};let G;H(y,!0),s.onChange=e=>{G=new Date(e)};const W=setInterval((()=>{G&&(H(G),G=void 0)}),1e3/60),Z=document.getElementById("chart-container")||document.body,q=document.createElement("div");Z.append(q);const J=c().ChartXY({container:q,theme:F}).setTitle("").setPadding({left:0,bottom:0,right:0,top:14}).setMouseInteractions(!1).setBackgroundFillStyle(F.cursorResultTableFillStyle);J.setBackgroundFillStyle(h).setBackgroundStrokeStyle(f).setSeriesBackgroundFillStyle(h).setSeriesBackgroundStrokeStyle(f),J.engine.setBackgroundFillStyle(h),J.getDefaultAxisY().dispose(),J.getDefaultAxisX().setAnimationScroll(!1);const K=J.addUIElement(p.Column).setPosition({x:0,y:100}).setOrigin(T.LeftTop).setBackground((e=>e.setStrokeStyle(f).setFillStyle(h))),Q=e=>K.addElement(u.TextBox).setText(e),ee=Q("");F.isDark||ee.setTextFillStyle(new S({color:m("rgb(255,255,255)")}));const te=(e,t,o,s,a)=>{const i=new S({color:m(e)}),r=J.addAxisY().setInterval({start:0,end:o,stopAxisAfter:!1}).setScrollStrategy(n.expansion);return{series:J.addLineSeries({yAxis:r,dataPattern:{pattern:"ProgressiveX"}}).setCursorInterpolationEnabled(!1).setStrokeStyle((e=>e.setFillStyle(i))),label:Q(t).setTextFillStyle(i),valueLabel:J.addUIElement(u.TextBox,{x:J.getDefaultAxisX(),y:r}).setOrigin(T.RightBottom).setTextFillStyle(i).setText("").setBackground((e=>e.setStrokeStyle(f).setFillStyle(h))),format:s,dataSet:a}},oe={people_vaccinated_per_hundred:te("rgb(0, 255, 0)","Vaccinations",100,(e=>void 0!==e.people_vaccinated_per_hundred?`${e.people_vaccinated_per_hundred.toFixed(1)}%`:void 0),t),new_cases_per_million:te("rgb(255, 255, 0)","New cases",1e3,(e=>void 0!==e.new_cases?String(e.new_cases):void 0),e),hosp_patients_per_million:te("rgb(255, 127, 0)","Hospitalized",100,(e=>void 0!==e.hosp_patients?String(e.hosp_patients):void 0),e),icu_patients_per_million:te("rgb(255, 0, 0)","Severe cases",50,(e=>void 0!==e.icu_patients?String(e.icu_patients):void 0),e)};let se,ne,ae;q.style.position="absolute",q.style.top="0px",q.style.backgroundColor="rgba(0,0,0,0.7)",q.style.border="solid 8px transparent",q.style.borderRadius="16px",q.style.width="280px",q.style.height="200px",q.style.transition="left 0.2s, top 0.2s, opacity 0.5s",q.style.opacity="0.0",q.style.pointerEvents="none",J.forEachAxis((e=>e.setTickStrategy(a.Empty).setStrokeStyle(f).setMouseInteractions(!1))),I.onMapDataReady((()=>{setTimeout((()=>{se={countryCode:"ITA",x:12.83,y:42.83}}),500)})),$.onSeriesBackgroundMouseMove(((e,t)=>{const o=j.solveNearestFromScreen(t);o&&(se=o.location,ae=se.countryCode)})),$.onSeriesBackgroundMouseLeave((()=>{ne=void 0,se=void 0}));const ie=setInterval((()=>{if(se&&se.countryCode!==ne){const s=$.translateCoordinate(se,$.coordsAxis,$.coordsClient),n=Z.getBoundingClientRect();q.style.left=`${Math.max(s.clientX-(290+n.left),10)}px`,q.style.top=`${Math.max(s.clientY-(210+n.top),10)}px`,q.style.opacity="1.0",J.engine.layout();const a=30,i=e[se.countryCode],r=t.find((e=>e.iso_code===se.countryCode)),l=o.find((e=>e.cca3===se.countryCode));ee.setText(`${l.name.common} previous 4 weeks`);const d=z(new Date(y.getTime()-24*a*60*60*1e3),y),c=i.data.filter((e=>d(e.date))),u=r.data.filter((e=>d(e.date)));for(const t of Object.keys(oe)){const{series:o,valueLabel:s,dataSet:n,format:a}=oe[t],i=n===e?c:u,r=i.map((e=>({x:V(e.date),y:void 0!==e[t]?e[t]:NaN}))).filter((e=>!Number.isNaN(e.y)));let l;o.clear().add(r);for(let e=r.length-1;e>=0&&(l=r[e],Number.isNaN(l.y));e-=1);if(s.setText(""),void 0!==l){let e;for(let t=i.length-1;t>=0&&(e=a(i[t]),!e);t-=1);if(e){const t={x:l.x,y:l.y};s.setText(e).setPosition(t)}}}ne=se.countryCode}se=void 0,ne||(q.style.opacity="0.0")}),1e3/60);X($.onSeriesBackgroundMouseClick.bind($),$.onSeriesBackgroundMouseDoubleClick.bind($),(e=>{if(window.performance.now()-C<750)return;const t=$.translateCoordinate(e,$.coordsRelative),o=$.getSizePixels(),s=t.x/o.x,n=t.y/o.y,a=L[i]||[];for(const e of a)if(s>=e.boundary.bottomLeft.x&&s<=e.boundary.topRight.x&&n>=e.boundary.bottomLeft.y&&n<=e.boundary.topRight.y)return le(),void M(e.mapType);ae&&(le(),B(ae,i,A))}),(e=>{window.performance.now()-C>2e3&&"World"!==i&&(le(),M("World"))}));const re=N.onMouseClick(((e,t)=>{"World"!==i&&window.performance.now()-C>500&&(le(),M("World"))}));let le=()=>{clearInterval(ie),clearInterval(W),I.dispose(),$.dispose(),J.dispose(),q.remove(),N.offMouseClick(re),le=()=>{}}},B=(r,l,c)=>{s&&s.deactivate(),E.setVisible(!1),U.setVisible(!0),N.setVisible(!0);const p=e[r],g=t.find((e=>e.iso_code===r)),m=o.find((e=>e.cca3===r)),y=(e,t,o,s,n,a)=>({property:e,dataSet:t,title:o,titleY:s,maxY:n,format:a}),x=[y("people_vaccinated_per_hundred",g,"Vaccination rate (at least 1 vaccine)","Vaccinated (%)",100,(e=>`${e.toFixed(1)}% received at least 1 vaccine`)),y(c?"new_cases_per_million":"new_cases",p,c?"New cases (relative to population)":"New cases",c?"per 1 million citizens":"New cases",c?1e3:void 0,c?e=>`${e.toFixed(0)} new cases per 1 million citizens`:e=>`${e.toFixed(0)} new cases`),y(c?"hosp_patients_per_million":"hosp_patients",p,c?"Hospital patients (relative to population)":"Hospital patients",c?"per 1 million citizens":"Hospital patients",c?100:void 0,c?e=>`${e.toFixed(0)} hospital patients per 1 million citizens`:e=>`${e.toFixed(0)} hospital patients`),y(c?"icu_patients_per_million":"icu_patients",p,c?"Intensive hospital care patients (relative to population)":"Intensive hospital care patients",c?"per 1 million citizens":"Intensive care patients",c?50:void 0,c?e=>`${e.toFixed(0)} intensive care patients per 1 million citizens`:e=>`${e.toFixed(0)} intensive care patients`)].map(((e,t,o)=>{const s=R.createChartXY({columnIndex:0,rowIndex:t}).setTitle(e.title).setPadding({left:0});if(0===t){const e=s.addUIElement(u.TextBox,s.coordsRelative).setText(`${m.name.common}`).setTextFont((e=>e.setSize(22))).setBackground((e=>e.setFillStyle(h).setStrokeStyle(f)));s.onResize((()=>{e.setPosition({x:140,y:s.getSizePixels().y}).setOrigin(T.LeftTop)}));const t=s.addUIElement(u.TextBox).setPosition({x:100,y:100}).setOrigin(T.RightTop).setMargin({top:14,right:24}).setDraggingMode(I.notDraggable);t.onMouseEnter((e=>s.engine.setMouseStyle(k.Point))),t.onMouseLeave((e=>s.engine.setMouseStyle(k.Default)));const o=e=>{e!==A&&(A=e,_(),B(r,l,e)),t.setText(e?"Show actual values":"Show relative values")};t.onMouseClick((e=>o(!A))),o(A)}const c=s.getDefaultAxisX().setAnimationScroll(!1);t<o.length-1?c.setMouseInteractions(!1).setThickness(0).setStrokeStyle(f).setTickStrategy(a.DateTime,(e=>e.setGreatTickStyle(i).setMajorTickStyle((e=>e.setLabelFillStyle(w).setTickStyle(f))).setMinorTickStyle((e=>e.setLabelFillStyle(w).setTickStyle(f))))):c.setTickStrategy(a.DateTime);const p=s.getDefaultAxisY().setTitle(e.titleY||"").setTitleFont((e=>e.setSize(12))).setThickness({min:80});void 0!==e.maxY&&p.setInterval({start:0,end:e.maxY,stopAxisAfter:!1}).setScrollStrategy(n.expansion);const g=s.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName(`${m.name.common}`).setCursorInterpolationEnabled(!1).setCursorResultTableFormatter(((t,o,s,n,a)=>t.addRow(`${m.name.common}`).addRow(c.formatValue(a.x)).addRow(e.format(n)))),y=e.dataSet.data.map((t=>({x:V(t.date),y:t[e.property]}))).filter((e=>void 0!==e.y&&e.x>=d));g.add(y);const x=$&&$[e.property];let S;if(x){S=s.addLineSeries({dataPattern:{pattern:"ProgressiveX"}}).setName("Global average").setCursorInterpolationEnabled(!1).setCursorResultTableFormatter(((t,o,s,n,a)=>t.addRow("Global average").addRow(c.formatValue(a.x)).addRow(e.format(n)))).add(x);const t=g.getStrokeStyle();S.setStrokeStyle(t.setFillStyle(t.getFillStyle().setA(100)))}return{...e,chart:s,series:g,seriesAverage:S}}));b(...x.map((e=>e.chart.getDefaultAxisX())));for(let e=0;e<4;e+=1)R.setRowHeight(e,e<x.length?1:0);const S=()=>{_&&_(),M(l)};x.forEach((e=>{X(e.chart.onSeriesBackgroundMouseClick.bind(e.chart),e.chart.onSeriesBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),S),X(e.chart.onBackgroundMouseClick.bind(e.chart),e.chart.onBackgroundMouseDoubleClick.bind(e.chart),(e=>{}),S)}));const v=N.onMouseClick((()=>S()));let _=()=>{x.forEach((e=>{e.chart.dispose()})),N.offMouseClick(v),_=void 0};C=window.performance.now()};let $;console.time("calculate global averages"),$={new_cases_per_million:[],hosp_patients_per_million:[],icu_patients_per_million:[]};for(const t of Object.keys($)){const o=new Map;for(const s of Object.keys(e)){const n=e[s];if(n)for(let e=0;e<n.data.length;e+=1){const s=n.data[e],a=s[t];if(void 0!==a){const e=o.get(s.date);e?(e.count+=1,e.sum+=a):o.set(s.date,{count:1,sum:a})}}}const s=Array.from(o.entries()).map((([e,t])=>({x:V(e),y:t.sum/t.count}))).sort(((e,t)=>e.x-t.x)).filter((e=>e.x>=d));$[t]=s}console.timeEnd("calculate global averages"),M("World")})();const z=(e,t)=>{const o=e.getFullYear(),s=e.getMonth(),n=e.getDate(),a=t.getFullYear(),i=t.getMonth(),r=t.getDate(),l=372*o+31*s+n,d=372*a+31*i+r;return e=>{const t=372*Number(e.substring(0,4))+31*(Number(e.substring(5,7))-1)+Number(e.substring(8,10));return t>=l&&t<=d}},V=e=>{const t=Number(e.substring(0,4)),o=Number(e.substring(5,7))-1,s=Number(e.substring(8,10));return new Date(t,o,s).getTime()},Y=e=>`${e.getFullYear()}-${$(e.getMonth()+1,2)}-${$(e.getDate(),2)}`,$=(e,t)=>{let o=String(e);for(;o.length<t;)o=`0${o}`;return o},X=(e,t,o,s)=>{let n=0;e(((e,t)=>{setTimeout((()=>{window.performance.now()-n>=500&&o(t)}),200)})),t(((e,t)=>{n=window.performance.now(),s(t)}))},O=(e,t,o)=>Math.min(Math.max(e,t),o)}},e=>{e.O(0,[502],(()=>(44,e(e.s=44)))),e.O()}]);